# Disclaimer Configuration Guide

## Overview

The AI analysis disclaimer is now centrally managed in the database `config` table. This allows you to change the disclaimer text in one place and have it automatically reflect across all exports and analysis outputs.

**Locations where the disclaimer appears:**
- PDF export footer (export service)
- Summary HTML in analysis results (AI advisor service)
- Any future features that need the disclaimer

## Quick Start

### View Current Disclaimer
```bash
source venv/bin/activate
python3 update_disclaimer.py --show
```

### Update Disclaimer to Default
```bash
source venv/bin/activate
python3 update_disclaimer.py
```

### Edit Disclaimer Directly

```bash
source venv/bin/activate

# Edit the disclaimer_text variable in update_disclaimer.py
nano update_disclaimer.py

# Run to update
python3 update_disclaimer.py
```

Or directly in SQLite:

```bash
sqlite3 mondrian.db

# View current
SELECT value FROM config WHERE key='disclaimer';

# Update
UPDATE config SET value='Your new disclaimer text here' WHERE key='disclaimer';

# Exit
.quit
```

## Default Disclaimer

The default disclaimer text is:

```
AI-Generated Analysis: This report is generated by artificial intelligence and represents a simulated perspective of the named advisor. It is not a professional critique from an actual photographer or art expert.

Creative Guidance Only: These recommendations should be used as creative guidance and inspiration, not as definitive professional advice. Individual artistic interpretation and personal vision may vary.

Not Professional Advice: This analysis is not a substitute for professional photography instruction, mentorship, or critique. For professional assessment, consult with qualified photography educators or critics.
```

## Locations in Code

### Database Seeding
- **File:** `init_database.py`
- **Function:** `init_database()`
- **Behavior:** Populates disclaimer when database is first initialized

### Configuration Management
- **File:** `update_disclaimer.py`
- **Functions:**
  - `get_disclaimer()` - Retrieve current disclaimer from database
  - `set_disclaimer()` - Update disclaimer in database
  - `main()` - CLI interface

### Export Service
- **File:** `mondrian/export_service_linux.py`
- **Function:** `get_disclaimer_text(db_path)`
- **Usage:** Called by `generate_consolidated_export_html()` to fetch disclaimer for PDF footer
- **Fallback:** Uses default if not found in database

### AI Advisor Service
- **File:** `mondrian/ai_advisor_service_linux.py`
- **Function:** `get_disclaimer_text(db_path)`
- **Usage:** Called by `_generate_summary_html()` to fetch disclaimer for analysis summary
- **Fallback:** Uses short default if not found in database

## Customization Examples

### Professional Version
```bash
# View file first to understand structure
cat update_disclaimer.py

# Edit the DEFAULT_DISCLAIMER variable
nano update_disclaimer.py
```

Change to:
```
This analysis is provided for educational purposes only and is generated by artificial intelligence.
It is not professional advice and should not be relied upon for decision-making.
Consult with a qualified photography professional for expert guidance.
```

Then:
```bash
source venv/bin/activate
python3 update_disclaimer.py
```

### Short Version (for mobile)
```
This is AI-generated creative guidance, not professional advice.
Personal artistic vision is most important.
```

### Extended Version
```
[Same as default but with additional sections about liability, accuracy, etc.]
```

## Integration with Existing Code

The code automatically handles missing disclaimers:

1. **Export Service:**
   - Tries to fetch from database
   - If not found, uses default hardcoded disclaimer
   - Formats as HTML for PDF display

2. **AI Advisor Service:**
   - Tries to fetch from database
   - If not found, uses short default
   - Wraps in `<p>` tag for HTML display

## Workflow for Changes

### One-time Change
```bash
# Edit the file
nano update_disclaimer.py

# Update database
source venv/bin/activate
python3 update_disclaimer.py

# Restart services to ensure fresh loads
pkill -f export_service_linux.py
python3 mondrian/export_service_linux.py &
```

### Regular Updates
Create a `disclaimers.db` or use environment variables:

```bash
# Set environment variable
export MONDRIAN_DISCLAIMER="Your disclaimer text"

# Access in code
import os
disclaimer = os.getenv('MONDRIAN_DISCLAIMER', default_disclaimer)
```

Or create a dedicated disclaimers.json:

```json
{
  "default": "Standard disclaimer...",
  "professional": "Professional disclaimer...",
  "mobile": "Short version..."
}
```

## Testing

### Verify Disclaimer in PDF Export
```bash
source venv/bin/activate

# Start export service
python3 mondrian/export_service_linux.py --port 5007 &

# Get job ID
JOB_ID=$(curl -s http://localhost:5005/jobs | grep '"id"' | head -1 | cut -d'"' -f4)

# Fetch export HTML
curl http://localhost:5007/export/$JOB_ID > export.html

# Check for your disclaimer text
grep "AI-Generated" export.html
```

### Verify Disclaimer in Analysis Output
```bash
source venv/bin/activate

# Check summary HTML in a completed job
curl http://localhost:5005/jobs/$JOB_ID | grep -A5 "disclaimer"
```

## Backup and Recovery

### Backup Current Disclaimer
```bash
sqlite3 mondrian.db "SELECT value FROM config WHERE key='disclaimer';" > disclaimer_backup.txt
```

### Restore from Backup
```bash
source venv/bin/activate

# Create update script
cat > restore_disclaimer.py << 'EOF'
import sqlite3
with open('disclaimer_backup.txt', 'r') as f:
    text = f.read()
conn = sqlite3.connect('mondrian.db')
conn.execute("UPDATE config SET value=? WHERE key='disclaimer'", (text,))
conn.commit()
print("âœ“ Restored disclaimer")
EOF

python3 restore_disclaimer.py
```

## FAQ

**Q: I updated the disclaimer but exports still show the old one**
A: Restart the export service: `pkill -f export_service_linux.py`

**Q: Where can I edit the disclaimer most easily?**
A: Either:
1. Edit `update_disclaimer.py` and run it, OR
2. Use SQLite directly: `sqlite3 mondrian.db` then `UPDATE config...`

**Q: What if the database gets corrupted?**
A: Reinitialize: `python3 init_database.py` (will repopulate with default disclaimer)

**Q: Can I have different disclaimers for different exports?**
A: Not yet, but you can:
1. Modify `get_disclaimer_text()` to check URL parameters
2. Store multiple disclaimers in config (e.g., `disclaimer_pdf`, `disclaimer_mobile`)
3. Switch based on context

**Q: Does restarting the app clear the disclaimer?**
A: No, it's stored in the database which persists across restarts.

## See Also

- [PDF_EXPORT_SETUP.md](PDF_EXPORT_SETUP.md) - How to set up PDF export
- [PDF_EXPORT_OPTIMIZATION.md](PDF_EXPORT_OPTIMIZATION.md) - Technical details about PDF export
