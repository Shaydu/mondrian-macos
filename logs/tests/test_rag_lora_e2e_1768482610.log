[2026-01-15 06:10:10,083] INFO: ================================================================================
[2026-01-15 06:10:10,083] INFO: TEST SESSION STARTED
[2026-01-15 06:10:10,083] INFO: ================================================================================
[2026-01-15 06:10:10,083] INFO: Log file: /Users/shaydu/dev/mondrian-macos/logs/tests/test_rag_lora_e2e_1768482610.log
[2026-01-15 06:10:10,083] INFO: Project root: /Users/shaydu/dev/mondrian-macos
[2026-01-15 06:10:10,084] INFO: Python version: 3.12.2 (v3.12.2:6abddd9f6a, Feb  6 2024, 17:02:06) [Clang 13.0.0 (clang-1300.0.29.30)]
[2026-01-15 06:10:10,084] INFO: Timestamp: 2026-01-15T06:10:10.084029
[2026-01-15 06:10:10,084] INFO: AI Service URL: http://localhost:5100
[2026-01-15 06:10:10,084] INFO: Test image: /Users/shaydu/dev/mondrian-macos/source/photo-B371453D-558B-40C5-910D-72940700046C-8d4c2233.jpg
[2026-01-15 06:10:10,084] INFO: Advisor: ansel
[2026-01-15 06:10:10,090] DEBUG: Starting new HTTP connection (1): localhost:5100
[2026-01-15 06:10:10,091] DEBUG: http://localhost:5100 "GET /health HTTP/1.1" 200 456
[2026-01-15 06:10:10,092] DEBUG: Starting new HTTP connection (1): localhost:5005
[2026-01-15 06:10:10,093] DEBUG: http://localhost:5005 "GET /health HTTP/1.1" 200 131
[2026-01-15 06:10:10,093] WARNING: TEST SKIPPED: Availability check deferred (will test during analysis)
[2026-01-15 06:10:10,093] INFO: INFO: If RAG+LoRA is unavailable, the service will automatically fallback to the next available mode
[2026-01-15 06:10:10,093] INFO: Starting basic workflow test
[2026-01-15 06:10:10,093] INFO: Image path: /Users/shaydu/dev/mondrian-macos/source/photo-B371453D-558B-40C5-910D-72940700046C-8d4c2233.jpg
[2026-01-15 06:10:10,093] INFO: Image size: 1939443 bytes
[2026-01-15 06:10:10,093] INFO: Request timestamp: 2026-01-15T06:10:10.093518
[2026-01-15 06:10:10,093] DEBUG: POST request to: http://localhost:5100/analyze
[2026-01-15 06:10:10,093] DEBUG: Data: {'advisor': 'ansel', 'mode': 'rag_lora', 'response_format': 'json'}
[2026-01-15 06:10:10,096] DEBUG: Starting new HTTP connection (1): localhost:5100
[2026-01-15 06:12:55,949] ERROR: Request EXCEPTION: ConnectionError: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))
[2026-01-15 06:12:55,954] ERROR: Exception details: ConnectionError(ProtocolError('Connection aborted.', RemoteDisconnected('Remote end closed connection without response')))
[2026-01-15 06:12:56,000] ERROR: Traceback: Traceback (most recent call last):
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 534, in _make_request
    response = conn.getresponse()
               ^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/connection.py", line 571, in getresponse
    httplib_response = super().getresponse()
                       ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py", line 1423, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py", line 300, in _read_status
    raise RemoteDisconnected("Remote end closed connection without"
http.client.RemoteDisconnected: Remote end closed connection without response

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/requests/adapters.py", line 486, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/util/retry.py", line 490, in increment
    raise reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/util/util.py", line 38, in reraise
    raise value.with_traceback(tb)
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 534, in _make_request
    response = conn.getresponse()
               ^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/urllib3/connection.py", line 571, in getresponse
    httplib_response = super().getresponse()
                       ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py", line 1423, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py", line 300, in _read_status
    raise RemoteDisconnected("Remote end closed connection without"
urllib3.exceptions.ProtocolError: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/shaydu/dev/mondrian-macos/test/rag-embeddings/test_rag_lora_e2e.py", line 210, in test_rag_lora_basic_workflow
    response = requests.post(
               ^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/shaydu/dev/mondrian-macos/mondrian/venv/lib/python3.12/site-packages/requests/adapters.py", line 501, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))

[2026-01-15 06:12:56,002] ERROR: TEST FAILED: Error: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))
[2026-01-15 06:12:56,029] DEBUG: Starting new HTTP connection (1): localhost:5100
[2026-01-15 06:12:56,031] ERROR: TEST FAILED: Error: HTTPConnectionPool(host='localhost', port=5100): Max retries exceeded with url: /analyze (Caused by NewConnectionError("HTTPConnection(host='localhost', port=5100): Failed to establish a new connection: [Errno 61] Connection refused"))
[2026-01-15 06:12:56,035] DEBUG: Starting new HTTP connection (1): localhost:5100
[2026-01-15 06:12:56,036] ERROR: TEST FAILED: Error: HTTPConnectionPool(host='localhost', port=5100): Max retries exceeded with url: /analyze (Caused by NewConnectionError("HTTPConnection(host='localhost', port=5100): Failed to establish a new connection: [Errno 61] Connection refused"))
[2026-01-15 06:12:56,050] DEBUG: Starting new HTTP connection (1): localhost:5100
[2026-01-15 06:12:56,051] ERROR: TEST FAILED: Error: HTTPConnectionPool(host='localhost', port=5100): Max retries exceeded with url: /analyze (Caused by NewConnectionError("HTTPConnection(host='localhost', port=5100): Failed to establish a new connection: [Errno 61] Connection refused"))
